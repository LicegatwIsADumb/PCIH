import requests
from bs4 import BeautifulSoup
import yt_dlp
import os


url = input("Digite o link da página que deseja analisar ou um vídeo do YouTube: ")

# Pasta onde os arquivos serão salvos
os.makedirs("downloads", exist_ok=True)

def baixar_arquivo(url, pasta):
    """Faz o download de um arquivo de mídia comum (imagem ou vídeo)"""
    nome_arquivo = os.path.join(pasta, url.split("/")[-1])
    with requests.get(url, stream=True) as r:
        r.raise_for_status()
        with open(nome_arquivo, "wb") as f:
            for chunk in r.iter_content(chunk_size=8192):
                f.write(chunk)
    print(f"Baixado: {nome_arquivo}")

def baixar_video_youtube(url):
    """Usa yt-dlp para baixar vídeos do YouTube"""
    ydl_opts = {
    'format': 'best',
    'outtmpl': 'downloads/%(title)s.%(ext)s'
    }

    with yt_dlp.YoutubeDL(ydl_opts) as ydl:
        ydl.download([url])
    print("Download do vídeo do YouTube concluído!")


if "youtube.com" in url or "youtu.be" in url:
    baixar_video_youtube(url)
else:
    # Faz a requisição para analisar a página
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')

    imagens = [img['src'] for img in soup.find_all('img') if 'src' in img.attrs]
    videos = [video['src'] for video in soup.find_all('video') if 'src' in video.attrs]

    midia = imagens + videos
    print("\nArquivos encontrados:")
    for i, media_url in enumerate(midia, 1):
        print(f"{i}. {media_url}")


    opcoes = input("\nDigite os números dos arquivos que deseja baixar, separados por vírgula: ")
    selecionados = [midia[int(i) - 1] for i in opcoes.split(",") if i.isdigit() and 1 <= int(i) <= len(midia)]


    for media_url in selecionados:
        if media_url.startswith("http"):
            baixar_arquivo(media_url, "downloads")

print("Processo concluído!")
